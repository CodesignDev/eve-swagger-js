<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>internal/ApiProvider.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Agents.html">Agents</a></li><li><a href="Alliance.html">Alliance</a><ul class='methods'><li data-type='method'><a href="Alliance.html#corporations">corporations</a></li><li data-type='method'><a href="Alliance.html#icon">icon</a></li><li data-type='method'><a href="Alliance.html#info">info</a></li></ul></li><li><a href="Alliances.html">Alliances</a><ul class='methods'><li data-type='method'><a href="Alliances.html#all">all</a></li><li data-type='method'><a href="Alliances.html#get">get</a></li><li data-type='method'><a href="Alliances.html#names">names</a></li></ul></li><li><a href="Api.html">Api</a></li><li><a href="Autopilot.html">Autopilot</a><ul class='methods'><li data-type='method'><a href="Autopilot.html#append">append</a></li><li data-type='method'><a href="Autopilot.html#destination">destination</a></li><li data-type='method'><a href="Autopilot.html#prepend">prepend</a></li></ul></li><li><a href="Bloodlines.html">Bloodlines</a><ul class='methods'><li data-type='method'><a href="Bloodlines.html#all">all</a></li></ul></li><li><a href="Bookmarks.html">Bookmarks</a><ul class='methods'><li data-type='method'><a href="Bookmarks.html#all">all</a></li><li data-type='method'><a href="Bookmarks.html#folders">folders</a></li></ul></li><li><a href="Calendar.html">Calendar</a><ul class='methods'><li data-type='method'><a href="Calendar.html#event">event</a></li><li data-type='method'><a href="Calendar.html#recent">recent</a></li></ul></li><li><a href="Categories.html">Categories</a><ul class='methods'><li data-type='method'><a href="Categories.html#all">all</a></li><li data-type='method'><a href="Categories.html#get">get</a></li></ul></li><li><a href="Category.html">Category</a><ul class='methods'><li data-type='method'><a href="Category.html#info">info</a></li></ul></li><li><a href="Character.html">Character</a><ul class='methods'><li data-type='method'><a href="Character.html#assets">assets</a></li><li data-type='method'><a href="Character.html#clones">clones</a></li><li data-type='method'><a href="Character.html#fleet">fleet</a></li><li data-type='method'><a href="Character.html#killmails">killmails</a></li><li data-type='method'><a href="Character.html#kills">kills</a></li><li data-type='method'><a href="Character.html#location">location</a></li><li data-type='method'><a href="Character.html#loyaltyPoints">loyaltyPoints</a></li><li data-type='method'><a href="Character.html#recentKillmails">recentKillmails</a></li><li data-type='method'><a href="Character.html#recentKills">recentKills</a></li><li data-type='method'><a href="Character.html#ship">ship</a></li><li data-type='method'><a href="Character.html#skillqueue">skillqueue</a></li><li data-type='method'><a href="Character.html#skills">skills</a></li><li data-type='method'><a href="Character.html#wallets">wallets</a></li></ul></li><li><a href="CharacterCorporation.html">CharacterCorporation</a><ul class='methods'><li data-type='method'><a href="CharacterCorporation.html#history">history</a></li><li data-type='method'><a href="CharacterCorporation.html#icon">icon</a></li><li data-type='method'><a href="CharacterCorporation.html#id">id</a></li><li data-type='method'><a href="CharacterCorporation.html#info">info</a></li><li data-type='method'><a href="CharacterCorporation.html#members">members</a></li><li data-type='method'><a href="CharacterCorporation.html#roles">roles</a></li></ul></li><li><a href="CharacterInfo.html">CharacterInfo</a><ul class='methods'><li data-type='method'><a href="CharacterInfo.html#history">history</a></li><li data-type='method'><a href="CharacterInfo.html#info">info</a></li><li data-type='method'><a href="CharacterInfo.html#portrait">portrait</a></li></ul></li><li><a href="Characters.html">Characters</a><ul class='methods'><li data-type='method'><a href="Characters.html#get">get</a></li><li data-type='method'><a href="Characters.html#names">names</a></li></ul></li><li><a href="Colonies.html">Colonies</a><ul class='methods'><li data-type='method'><a href="Colonies.html#all">all</a></li><li data-type='method'><a href="Colonies.html#layout">layout</a></li></ul></li><li><a href="Constellation.html">Constellation</a><ul class='methods'><li data-type='method'><a href="Constellation.html#info">info</a></li></ul></li><li><a href="Constellations.html">Constellations</a><ul class='methods'><li data-type='method'><a href="Constellations.html#all">all</a></li><li data-type='method'><a href="Constellations.html#get">get</a></li><li data-type='method'><a href="Constellations.html#names">names</a></li></ul></li><li><a href="Contact.html">Contact</a><ul class='methods'><li data-type='method'><a href="Contact.html#remove">remove</a></li><li data-type='method'><a href="Contact.html#update">update</a></li><li data-type='method'><a href="Contact.html#updateWatched">updateWatched</a></li></ul></li><li><a href="Contacts.html">Contacts</a><ul class='methods'><li data-type='method'><a href="Contacts.html#add">add</a></li><li data-type='method'><a href="Contacts.html#addWatched">addWatched</a></li><li data-type='method'><a href="Contacts.html#all">all</a></li><li data-type='method'><a href="Contacts.html#get">get</a></li><li data-type='method'><a href="Contacts.html#labels">labels</a></li></ul></li><li><a href="Corporation.html">Corporation</a><ul class='methods'><li data-type='method'><a href="Corporation.html#history">history</a></li><li data-type='method'><a href="Corporation.html#icon">icon</a></li><li data-type='method'><a href="Corporation.html#info">info</a></li><li data-type='method'><a href="Corporation.html#loyaltyOffers">loyaltyOffers</a></li></ul></li><li><a href="Corporations.html">Corporations</a><ul class='methods'><li data-type='method'><a href="Corporations.html#get">get</a></li><li data-type='method'><a href="Corporations.html#names">names</a></li><li data-type='method'><a href="Corporations.html#npc">npc</a></li></ul></li><li><a href="Event.html">Event</a><ul class='methods'><li data-type='method'><a href="Event.html#accept">accept</a></li><li data-type='method'><a href="Event.html#info">info</a></li><li data-type='method'><a href="Event.html#reject">reject</a></li><li data-type='method'><a href="Event.html#undecided">undecided</a></li></ul></li><li><a href="Factions.html">Factions</a><ul class='methods'><li data-type='method'><a href="Factions.html#all">all</a></li></ul></li><li><a href="Fitting.html">Fitting</a><ul class='methods'><li data-type='method'><a href="Fitting.html#del">del</a></li></ul></li><li><a href="Fittings.html">Fittings</a><ul class='methods'><li data-type='method'><a href="Fittings.html#add">add</a></li><li data-type='method'><a href="Fittings.html#all">all</a></li><li data-type='method'><a href="Fittings.html#get">get</a></li></ul></li><li><a href="Fleet.html">Fleet</a><ul class='methods'><li data-type='method'><a href="Fleet.html#info">info</a></li><li data-type='method'><a href="Fleet.html#invite">invite</a></li><li data-type='method'><a href="Fleet.html#kick">kick</a></li><li data-type='method'><a href="Fleet.html#members">members</a></li><li data-type='method'><a href="Fleet.html#move">move</a></li><li data-type='method'><a href="Fleet.html#update">update</a></li></ul></li><li><a href="Freeports.html">Freeports</a><ul class='methods'><li data-type='method'><a href="Freeports.html#all">all</a></li></ul></li><li><a href="Group.html">Group</a><ul class='methods'><li data-type='method'><a href="Group.html#info">info</a></li></ul></li><li><a href="Groups.html">Groups</a><ul class='methods'><li data-type='method'><a href="Groups.html#all">all</a></li><li data-type='method'><a href="Groups.html#get">get</a></li></ul></li><li><a href="Incursions.html">Incursions</a><ul class='methods'><li data-type='method'><a href="Incursions.html#all">all</a></li></ul></li><li><a href="Industry.html">Industry</a><ul class='methods'><li data-type='method'><a href="Industry.html#facilities">facilities</a></li><li data-type='method'><a href="Industry.html#systemCosts">systemCosts</a></li></ul></li><li><a href="Insurance.html">Insurance</a><ul class='methods'><li data-type='method'><a href="Insurance.html#prices">prices</a></li></ul></li><li><a href="Killmail.html">Killmail</a><ul class='methods'><li data-type='method'><a href="Killmail.html#get">get</a></li></ul></li><li><a href="Label.html">Label</a><ul class='methods'><li data-type='method'><a href="Label.html#del">del</a></li></ul></li><li><a href="Labels.html">Labels</a><ul class='methods'><li data-type='method'><a href="Labels.html#all">all</a></li><li data-type='method'><a href="Labels.html#create">create</a></li><li data-type='method'><a href="Labels.html#get">get</a></li></ul></li><li><a href="Mail.html">Mail</a><ul class='methods'><li data-type='method'><a href="Mail.html#all">all</a></li><li data-type='method'><a href="Mail.html#cspaCost">cspaCost</a></li><li data-type='method'><a href="Mail.html#get">get</a></li><li data-type='method'><a href="Mail.html#inbox">inbox</a></li><li data-type='method'><a href="Mail.html#lists">lists</a></li><li data-type='method'><a href="Mail.html#send">send</a></li><li data-type='method'><a href="Mail.html#unreadCount">unreadCount</a></li></ul></li><li><a href="Message.html">Message</a><ul class='methods'><li data-type='method'><a href="Message.html#del">del</a></li><li data-type='method'><a href="Message.html#info">info</a></li><li data-type='method'><a href="Message.html#update">update</a></li></ul></li><li><a href="Moon.html">Moon</a><ul class='methods'><li data-type='method'><a href="Moon.html#info">info</a></li></ul></li><li><a href="Moons.html">Moons</a><ul class='methods'><li data-type='method'><a href="Moons.html#get">get</a></li></ul></li><li><a href="Planet.html">Planet</a><ul class='methods'><li data-type='method'><a href="Planet.html#info">info</a></li></ul></li><li><a href="PlanetaryInteraction.html">PlanetaryInteraction</a><ul class='methods'><li data-type='method'><a href="PlanetaryInteraction.html#schematic">schematic</a></li></ul></li><li><a href="Planets.html">Planets</a><ul class='methods'><li data-type='method'><a href="Planets.html#get">get</a></li></ul></li><li><a href="Races.html">Races</a><ul class='methods'><li data-type='method'><a href="Races.html#all">all</a></li></ul></li><li><a href="Region.html">Region</a><ul class='methods'><li data-type='method'><a href="Region.html#buyOrdersFor">buyOrdersFor</a></li><li data-type='method'><a href="Region.html#history">history</a></li><li data-type='method'><a href="Region.html#info">info</a></li><li data-type='method'><a href="Region.html#orders">orders</a></li><li data-type='method'><a href="Region.html#ordersFor">ordersFor</a></li><li data-type='method'><a href="Region.html#sellOrdersFor">sellOrdersFor</a></li></ul></li><li><a href="Regions.html">Regions</a><ul class='methods'><li data-type='method'><a href="Regions.html#all">all</a></li><li data-type='method'><a href="Regions.html#get">get</a></li><li data-type='method'><a href="Regions.html#names">names</a></li></ul></li><li><a href="Search.html">Search</a><ul class='methods'><li data-type='method'><a href="Search.html#get">get</a></li><li data-type='method'><a href="Search.html#strict">strict</a></li></ul></li><li><a href="SolarSystem.html">SolarSystem</a><ul class='methods'><li data-type='method'><a href="SolarSystem.html#info">info</a></li></ul></li><li><a href="SolarSystems.html">SolarSystems</a><ul class='methods'><li data-type='method'><a href="SolarSystems.html#all">all</a></li><li data-type='method'><a href="SolarSystems.html#get">get</a></li><li data-type='method'><a href="SolarSystems.html#names">names</a></li></ul></li><li><a href="Sovereignty.html">Sovereignty</a><ul class='methods'><li data-type='method'><a href="Sovereignty.html#campaigns">campaigns</a></li><li data-type='method'><a href="Sovereignty.html#structures">structures</a></li></ul></li><li><a href="Squad.html">Squad</a><ul class='methods'><li data-type='method'><a href="Squad.html#remove">remove</a></li><li data-type='method'><a href="Squad.html#rename">rename</a></li></ul></li><li><a href="Squads.html">Squads</a><ul class='methods'><li data-type='method'><a href="Squads.html#add">add</a></li><li data-type='method'><a href="Squads.html#get">get</a></li></ul></li><li><a href="Stargate.html">Stargate</a><ul class='methods'><li data-type='method'><a href="Stargate.html#info">info</a></li></ul></li><li><a href="Stargates.html">Stargates</a><ul class='methods'><li data-type='method'><a href="Stargates.html#get">get</a></li></ul></li><li><a href="Station.html">Station</a><ul class='methods'><li data-type='method'><a href="Station.html#info">info</a></li></ul></li><li><a href="Stations.html">Stations</a><ul class='methods'><li data-type='method'><a href="Stations.html#get">get</a></li><li data-type='method'><a href="Stations.html#names">names</a></li></ul></li><li><a href="Structure.html">Structure</a><ul class='methods'><li data-type='method'><a href="Structure.html#buyOrdersFor">buyOrdersFor</a></li><li data-type='method'><a href="Structure.html#info">info</a></li><li data-type='method'><a href="Structure.html#orders">orders</a></li><li data-type='method'><a href="Structure.html#ordersFor">ordersFor</a></li><li data-type='method'><a href="Structure.html#sellOrdersFor">sellOrdersFor</a></li></ul></li><li><a href="Structures.html">Structures</a><ul class='methods'><li data-type='method'><a href="Structures.html#get">get</a></li></ul></li><li><a href="Type.html">Type</a><ul class='methods'><li data-type='method'><a href="Type.html#info">info</a></li></ul></li><li><a href="Types.html">Types</a><ul class='methods'><li data-type='method'><a href="Types.html#all">all</a></li><li data-type='method'><a href="Types.html#get">get</a></li><li data-type='method'><a href="Types.html#names">names</a></li><li data-type='method'><a href="Types.html#prices">prices</a></li></ul></li><li><a href="War.html">War</a><ul class='methods'><li data-type='method'><a href="War.html#info">info</a></li><li data-type='method'><a href="War.html#killmails">killmails</a></li><li data-type='method'><a href="War.html#kills">kills</a></li></ul></li><li><a href="Wars.html">Wars</a><ul class='methods'><li data-type='method'><a href="Wars.html#get">get</a></li><li data-type='method'><a href="Wars.html#recent">recent</a></li></ul></li><li><a href="Window.html">Window</a><ul class='methods'><li data-type='method'><a href="Window.html#contract">contract</a></li><li data-type='method'><a href="Window.html#info">info</a></li><li data-type='method'><a href="Window.html#market">market</a></li><li data-type='method'><a href="Window.html#newMail">newMail</a></li></ul></li><li><a href="Wing.html">Wing</a><ul class='methods'><li data-type='method'><a href="Wing.html#remove">remove</a></li><li data-type='method'><a href="Wing.html#rename">rename</a></li></ul></li><li><a href="Wings.html">Wings</a><ul class='methods'><li data-type='method'><a href="Wings.html#add">add</a></li><li data-type='method'><a href="Wings.html#all">all</a></li><li data-type='method'><a href="Wings.html#get">get</a></li></ul></li><li><a href="Wormholes.html">Wormholes</a></li></ul><h3>Modules</h3><ul><li><a href="module-eve_swagger_interface.html">eve_swagger_interface</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">internal/ApiProvider.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Cache = require('node-cache');
const Moment = require('moment');
const Promise = require('bluebird');
const VError = require('verror');

const ESI = require('../../generated/src');


const CLIENT_ERROR = 'esi:ClientError';
const FORBIDDEN_ERROR = 'esi:ForbiddenError';
const NOT_FOUND_ERROR = 'esi:NotFoundError';
const INTERNAL_SERVER_ERROR = 'esi:InternalServerError';
const GENERIC_ERROR = 'esi:Error';

/**
 * Get a cached ApiClient instance configured via `provider` and use the
 * given SSO `accessToken`. If `accessToken` is provided, the ApiClient will
 * only be cached for a limited time before it is deleted from the cache to help
 * with automated clean up of access tokens.
 *
 * @param provider {ApiProvider} The api configuration provider
 * @param accessToken {String} Optional; the character access token
 * @return {ApiClient}
 * @memberOf ApiProvider
 * @private
 */
function getApiClient(provider, accessToken = '') {
  let client = provider._apiCache.get(accessToken);
  if (!client) {
    // Must create a new ApiClient for the eveURL + token
    client = new ESI.ApiClient();

    let ttl = 0; // By default don't expire the client
    if (accessToken &amp;&amp; accessToken != '') {
      // Insert access token and change it so the client expires
      client.authentications['evesso'].accessToken = accessToken;
      ttl = 3600; // 1 hour
    }

    // Set other configuration options on the client from provider
    client.basePath = provider._eveURL.replace(/\/+$/, '');
    client.defaultHeaders = { 'User-Agent': provider._userAgent };
    client.timeout = provider._timeout;

    provider._apiCache.set(accessToken, client, ttl);
  }

  return client;
}

/**
 * Get a cached ESI API instance, where the API is specified by `apiName`, which
 * must correspond to one of the types in `generated/src/api` module.
 *
 * @param provider {ApiProvider} The api configuration provider
 * @param apiName {String} The name of the API to get
 * @param accessToken {String} Optional; the character access token
 * @returns {*} An instance of ESI[apiName]
 * @memberOf ApiProvider
 * @private
 */
function getApi(provider, apiName, accessToken) {
  let apiClient = getApiClient(provider, accessToken);
  if (!apiClient.hasOwnProperty(apiName)) {
    // Make a new type specific API and attach it to the ApiClient for later use
    let api = new ESI[apiName](apiClient);

    // Attach a cache to the created instance
    api._requestCache = new Cache({ useClones: false });

    apiClient[apiName] = api;
    return api;
  } else {
    return apiClient[apiName];
  }
}

/**
 * Invoke the function, `functionName` on `api` if an http request must actually
 * be made. The function will be invoked with `args`, which must be an array of
 * arguments as you'd pass to `Function.apply()`. `opts` is used as the last
 * argument after the end of `args`.
 *
 * This will cache data and error responses, where the cache time is based on
 * the "expires" header in the http response.
 *
 * `resolve` and `reject` must be Promise handler functions, as provided by
 * the Promise constructor.
 *
 * @param {*} api The ESI Api instance to use for the query
 * @param {String} functionName The name of a function callable on this.
 * @param {Array} args Array of arguments to pass to ESI Api function call
 * @param {Object} opts Optional parameter object to pass to the ESI call
 * @param {Function} resolve Promise resolve handler
 * @param {Function} reject Promise error resolution handler
 * @private
 */
function getCachedRequest(api, functionName, args, opts, resolve, reject) {
  let key = functionName + '/' + JSON.stringify(args) + '+' + JSON.stringify(
          opts);

  let cache = api._requestCache;
  let blob = cache.get(key);
  if (blob == undefined) {
    // Request isn't cached any more, so must make the request anew

    // Append the options and callback function to the arguments array
    let fullArgs = args.slice(0);
    fullArgs.push(opts);
    fullArgs.push(function(error, data, response) {
      // Look up all collected resolve/reject handlers in the cache
      let toNotify = cache.get(key);
      try {
        // Set state of cache to received data before resolving
        // promises, with a timeout based on expires header.
        let timeout = 0;
        if (response &amp;&amp; response.header &amp;&amp; response.header['expires']) {
          let expires = Moment.utc(response.header['expires'],
              'ddd, DD MMM YYYY HH:mm:ss GMT');
          timeout = expires.diff(Moment.utc([]), 'seconds', true);
        }

        if (error) {
          let type = GENERIC_ERROR;
          if (error.status == 400) {
            type = CLIENT_ERROR;
          } else if (error.status == 404) {
            type = NOT_FOUND_ERROR;
          } else if (error.status == 403 || error.status == 401) {
            type = FORBIDDEN_ERROR;
          } else if (error.status >= 500) {
            type = INTERNAL_SERVER_ERROR;
          }

          let err;
          if (error.response &amp;&amp; error.response.error) {
            if (error.response.text) {
              err = new VError({
                name: type,
                cause: error.response.error
              }, 'Error from ESI service for %s: %s', functionName, error.response.text);
            } else {
              err = new VError({
                name: type,
                cause: error.response.error
              }, 'Error response code from ESI service for %s', functionName);
            }
          } else {
            err = new VError({
              name: type,
              cause: error
            }, 'Error contacting ESI service for %s', functionName);
          }

          cache.set(key, { error: err }, timeout);
          for (let r of toNotify.onReject) {
            r(err);
          }
        } else {
          // Make sure data isn't null
          data = data || {};
          cache.set(key, { data: data }, timeout);
          for (let r of toNotify.onResolve) {
            r(data);
          }
        }
      } catch (e) {
        // Clear cache so that it can be tried again
        cache.set(key, null);

        // Wrap error
        let err = new VError({
          name: GENERIC_ERROR,
          cause: e
        }, 'Unexpected exception in callback to %s', functionName);

        // Push the exception caught in the ESI callback to all the
        // registered rejects.
        if (toNotify &amp;&amp; toNotify.onReject) {
          for (let r of toNotify.onReject) {
            r(err);
          }
        } else {
          // In this worst case scenario, at least notify the
          // reject handler that was provided initially (will not
          // reject any subsequently cached handlers but that
          // shouldn't happen).
          reject(err);
        }
      }
    });

    // Invoke ESI function
    try {
      api[functionName].apply(api, fullArgs);
    } catch (err) {
      // Wrap in a VError with associated type
      throw new VError({
        name: CLIENT_ERROR,
        cause: err
      }, 'Failed to call %s', functionName);
    }

    // Set in cache after API call, in the event that the API function
    // fails on validation before it gets to the point where it handles
    // the callback which would notify the resolve/reject listeners.
    // - No timeout yet so that this won't expire until ESI request
    //   is completed or times-out on its own
    cache.set(key, {
      onResolve: [resolve],
      onReject: [reject]
    });
  } else if (blob.data) {
    // A previous request has completed successfully, so just invoke
    // the provided resolve.
    resolve(blob.data);
  } else if (blob.error) {
    // A previous request has completed with an error, so just invoke
    // the provided reject.
    reject(blob.error);
  } else {
    // A prior equivalent request has been initiated but hasn't
    // completed, so append the promise handlers to the cache blob.
    blob.onResolve.push(resolve);
    blob.onReject.push(reject);
  }
}

/**
 * Primary access point to invoking specific ESI Api's with the Promise-wrapping
 * `newRequest` function.
 * @private
 */
class PromiseApi {
  /**
   * Create a new PromiseApi that wraps the given ESI `apiType`, configured
   * via `provider` and with optional auth from `accessToken`.
   *
   * @param apiType {String} The ESI Api class to instantiate
   * @param provider {ApiProvider} The api configuration and cache provider
   * @param accessToken {String} The optional SSO access token
   * @constructor
   */
  constructor(apiType, provider, accessToken) {
    this._apiType = apiType;
    this._provider = provider;
    this._accessToken = accessToken;
  }

  /**
   * Create a new Promise for invoking the ESI request represented by `method`,
   * which must be a function on the underlying Api instance. The function is
   * called with arguments in the array, `args`. The `opts` argument is
   * presumed
   * to be an object used as the last argument to the API request, and will be
   * modified to include additional default properties configured by the
   * factory.
   *
   * @param {String} method The name of a function callable on the Api
   *     instance.
   * @param {Array} args Array of arguments to pass to ESI Api function call
   * @param {Object} opts Optional parameters object to pass to the ESI call
   * @return {Promise} A new promise that resolves to the data returned
   *     by the request
   */
  newRequest(method, args, opts = {}) {
    let _this = this;
    return new Promise(function(resolve, reject) {
      // Get an ESi.XApi instance, possibly cached, that is configured to use
      // the provider's config and given access token
      let api = getApi(_this._provider, _this._apiType, _this._accessToken);
      // Form full opts object based on the provider's default options
      opts = Object.assign({}, opts, _this._provider._defaultOpts);
      getCachedRequest(api, method, args, opts, resolve, reject);
    });
  }
}

/**
 * Configuration and factory function for getting Promise-wrapping `PromiseApi`
 * instances for each of the generated ESI Api's.
 * @private
 */
class ApiProvider {
  /**
   * Create a new ApiProvider with the given configuration provided in a single
   * object map. If no argument is provided, the defaults are used.
   *
   * @param service {String} URL to the ESI service
   * @param source {String} Data source used
   * @param agent {String} Custom user agent string to send with each request
   * @param language {String} Language character code
   * @param timeout {Number} Request timeout in milliseconds
   * @constructor
   */
  constructor({
      service: service, source: source, agent: agent, language: language, timeout: timeout
  }) {
    // Save URL, agent, and timeout for later as they configure the ApiClient
    this._eveURL = service;
    this._userAgent = agent;
    this._timeout = timeout;

    this._defaultOpts = {
      'datasource': source,
      'language': language,
      'acceptLanguage': language
    };

    // Keyed on access token, returns an ApiClient instance
    this._apiCache = new Cache({ useClones: false });
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link AllianceApi
   */
  alliance(accessToken = '') {
    return new PromiseApi('AllianceApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link AssetsApi
   */
  assets(accessToken = '') {
    return new PromiseApi('AssetsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link BookmarksApi
   */
  bookmarks(accessToken = '') {
    return new PromiseApi('BookmarksApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link CalendarApi
   */
  calendar(accessToken = '') {
    return new PromiseApi('CalendarApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link CharacterApi
   */
  character(accessToken = '') {
    return new PromiseApi('CharacterApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link ClonesApi
   */
  clones(accessToken = '') {
    return new PromiseApi('ClonesApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link ContactsApi
   */
  contacts(accessToken = '') {
    return new PromiseApi('ContactsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link CorporationApi
   */
  corporation(accessToken = '') {
    return new PromiseApi('CorporationApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link FittingsApi
   */
  fittings(accessToken = '') {
    return new PromiseApi('FittingsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link FleetsApi
   */
  fleets(accessToken = '') {
    return new PromiseApi('FleetsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link IncursionsApi
   */
  incursions(accessToken = '') {
    return new PromiseApi('IncursionsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link IndustryApi
   */
  industry(accessToken = '') {
    return new PromiseApi('IndustryApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link InsuranceApi
   */
  insurance(accessToken = '') {
    return new PromiseApi('InsuranceApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link KillmailsApi
   */
  killmails(accessToken = '') {
    return new PromiseApi('KillmailsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link LocationApi
   */
  location(accessToken = '') {
    return new PromiseApi('LocationApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link LoyaltyApi
   */
  loyalty(accessToken = '') {
    return new PromiseApi('LoyaltyApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link MailApi
   */
  mail(accessToken = '') {
    return new PromiseApi('MailApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link MarketApi
   */
  market(accessToken = '') {
    return new PromiseApi('MarketApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link PlanetaryInteractionApi
   */
  planetaryInteraction(accessToken = '') {
    return new PromiseApi('PlanetaryInteractionApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link SearchApi
   */
  search(accessToken = '') {
    return new PromiseApi('SearchApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link SkillsApi
   */
  skills(accessToken = '') {
    return new PromiseApi('SkillsApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link SovereigntyApi
   */
  sovereignty(accessToken = '') {
    return new PromiseApi('SovereigntyApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link UniverseApi
   */
  universe(accessToken = '') {
    return new PromiseApi('UniverseApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link UserInterfaceApi
   */
  userInterface(accessToken = '') {
    return new PromiseApi('UserInterfaceApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link WalletApi
   */
  wallet(accessToken = '') {
    return new PromiseApi('WalletApi', this, accessToken);
  }

  /**
   * Create a new PromiseApi.
   *
   * @param accessToken {String} Optional character access token for all
   *     requests.
   * @returns {PromiseApi}
   * @esi_link WarsApi
   */
  wars(accessToken = '') {
    return new PromiseApi('WarsApi', this, accessToken);
  }
}

module.exports = ApiProvider;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
